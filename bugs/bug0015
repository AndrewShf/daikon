Version:      $Id$
Owner:        Alan <adonovan@lcs.mit.edu>, Jeremy <mistere>
Tool:         dfej
Summary:      dfej+context causes testcase RatNum to fail during execution
Severity:     Vexing
Status:       Closed
Reproducible: No
Description:

[mistere]
I can no longer reproduce this bug, so I'm marking it closed.  It may
have been fixed when I changed the testing infrastructure to
callsite-transform all files, instead of just instumented ones.

[06-Mar-02, adonovan, quoting mistere on 29-Nov-01]
So the test case which fails is esc-experiments/RatNum.  First make
sure you have the latest files from $inv/tests/ (cvs up it).

Also, you might have to change line 405 in $inv/tests/Makefile.common
to set it to where your dfej+context is built.  For me, it is:

  DFEJ_EXECUTABLE:=$(INV)/dfej/src/dfej

Then, you should be able to replicate the following.  The error is
that the program no longer passes its test suite.

[mistere@yam RatNum]$ pwd
/g1/users/mistere/research/invariants/tests/esc-experiments/RatNum
[mistere@yam RatNum]$ setenv CALLSITE_GRAIN line
[mistere@yam RatNum]$ make clean context

### clean-output (esc-experiments/RatNum)

......

### instrument (ratnum)

rm -rf /scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files
mkdir /scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files
cd /g1/users/mistere/research/invariants/tests/sources && /g1/users/mistere/bin/jikes -g +F -depend -d /scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files \
        -classpath .:.:/g1/users/mistere/research/invariants/java:/g2/users/mernst/java/jdk/jre/lib/rt.jar:/g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar:/g1/users/mistere/research/invariants/java/lib/java-getopt.jar:/g1/users/mistere/research/invariants/java/lib/junit.jar:/g4/projects/invariants/lib/jswat.jar `cat /scratch/mistere/tests/esc-experiments/RatNum/.all-files`
cd /scratch/mistere/tests/esc-experiments/RatNum && rm -f `cat /scratch/mistere/tests/esc-experiments/RatNum/.instrument-files`
cd /g1/users/mistere/research/invariants/tests/sources && /g1/users/mistere/research/invariants/dfej/src/dfej +daikon_context -declsfiledir=/scratch/mistere/tests/esc-experiments/RatNum  -instrsourcedir=/scratch/mistere/tests/esc-experiments/RatNum \
        -ajax_runnable=PolyCalc.PublicTest \
        -ajaxap=.:/scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files:.:/g1/users/mistere/research/invariants/java:/g2/users/mernst/research/invariants/java/ajax-ship/tweaked-classes.zip:/g2/users/mernst/java/jdk/jre/lib/rt.jar:/g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar:/g1/users/mistere/research/invariants/java/lib/java-getopt.jar:/g1/users/mistere/research/invariants/java/lib/junit.jar:/g4/projects/invariants/lib/jswat.jar \
        -classpath .:/scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files:.:/g1/users/mistere/research/invariants/java:/g2/users/mernst/java/jdk/jre/lib/rt.jar:/g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar:/g1/users/mistere/research/invariants/java/lib/java-getopt.jar:/g1/users/mistere/research/invariants/java/lib/junit.jar:/g4/projects/invariants/lib/jswat.jar \
        `cat /scratch/mistere/tests/esc-experiments/RatNum/.instrument-files`
Applying context-sensitive transformations...
ajax command: java -cp /g2/users/mernst/research/invariants/java/ajax-ship ajax.tools.benchmarks.ComparablePairsDescFileReader -cp /g2/users/mernst/research/invariants/java/ajax-ship/tweaked-classes.zip -ap .:/scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files:.:/g1/users/mistere/research/invariants/java:/g2/users/mernst/research/invariants/java/ajax-ship/tweaked-classes.zip:/g2/users/mernst/java/jdk/jre/lib/rt.jar:/g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar:/g1/users/mistere/research/invariants/java/lib/java-getopt.jar:/g1/users/mistere/research/invariants/java/lib/junit.jar:/g4/projects/invariants/lib/jswat.jar PolyCalc.PublicTest -declsdir /scratch/mistere/tests/esc-experiments/RatNum/ -rewrite /scratch/mistere/tests/esc-experiments/RatNum/PolyCalc/RatNum.decls 
Invalid class data loading class java.security.SecureClassLoader (Abstract method method java.lang.Class loadClass(java.lang.String, boolean) in class java.lang.ClassLoader (classloader StandardClassLoader[directory ., directory /scratch/mistere/tests/esc-experiments/RatNum/dfej-class-files, directory ., directory /g1/users/mistere/research/invariants/java, zip file /g2/users/mernst/research/invariants/java/ajax-ship/tweaked-classes.zip, zip file /g2/users/mernst/java/jdk/jre/lib/rt.jar, zip file /g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar, zip file /g1/users/mistere/research/invariants/java/lib/java-getopt.jar, zip file /g1/users/mistere/research/invariants/java/lib/junit.jar, zip file /g4/projects/invariants/lib/jswat.jar]) of non-abstract class java.security.SecureClassLoader not implemented)
Processing 'n'
Processing 'daikon_callsite_id'
In /scratch/mistere/tests/esc-experiments/RatNum/PolyCalc/RatNum.decls: Variable not found: daikon_callsite_id at line 16
Problem with Ajax!  Using original .decls files instead.
mv -f /g1/users/mistere/research/invariants/tests/sources/log /scratch/mistere/tests/esc-experiments/RatNum/ajax.log
touch /scratch/mistere/tests/esc-experiments/RatNum/.instrument-timestamp
perl -p -i.bak -e 'BEGIN { undef $/} s/(daikon_callsite_id\n)int(\nint\n22\n)/$1hashcode$2/g;' `find /scratch/mistere/tests/esc-experiments/RatNum -name '*.decls'`
touch /scratch/mistere/tests/esc-experiments/RatNum/.decls-rewrite-timestamp

### compile (ratnum)

cd /scratch/mistere/tests/esc-experiments/RatNum && /g1/users/mistere/bin/jikes -classpath .:.:/g1/users/mistere/research/invariants/java:/g2/users/mernst/java/jdk/jre/lib/rt.jar:/g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar:/g1/users/mistere/research/invariants/java/lib/java-getopt.jar:/g1/users/mistere/research/invariants/java/lib/junit.jar:/g4/projects/invariants/lib/jswat.jar `find . -name '*.java'`
touch /scratch/mistere/tests/esc-experiments/RatNum/.compile-timestamp

### data (ratnum)

java -Xmx256m -classpath /scratch/mistere/tests/esc-experiments/RatNum:.:/g1/users/mistere/research/invariants/java:/g2/users/mernst/java/jdk/jre/lib/rt.jar:/g1/users/mistere/research/invariants/java/lib/jakarta-oro.jar:/g1/users/mistere/research/invariants/java/lib/java-getopt.jar:/g1/users/mistere/research/invariants/java/lib/junit.jar:/g4/projects/invariants/lib/jswat.jar -DDTRACEFILE=/scratch/mistere/tests/esc-experiments/RatNum/ratnum.dtrace \
         PolyCalc.PublicTest 
testOneArgCtor
Exception in thread "main" junit.framework.AssertionFailedError: expected:<0> but was:<NaN>
        at junit.framework.Assert.fail(Assert.java:37)
        at junit.framework.Assert.failNotEquals(Assert.java:235)
        at junit.framework.Assert.assertEquals(Assert.java:56)
        at junit.framework.Assert.assertEquals(Assert.java:64)
        at PolyCalc.RatNumTest.eq(RatNumTest.java:70)
        at PolyCalc.RatNumTest.testOneArgCtor(RatNumTest.java:74)
        at PolyCalc.PublicTest.run_directly(PublicTest.java:15)
        at PolyCalc.PublicTest.main(PublicTest.java:9)
make: *** [/scratch/mistere/tests/esc-experiments/RatNum/.run-timestamp] Error 1

--
$Log$
Revision 1.2  2002-03-28 00:54:41  mistere
changed bug0015

Revision 1.1  2002/03/07 06:42:18  adonovan
new bug0015

