Version:      $Id$
Owner:        Mike <mernst>, Jeremy <mistere>
Tool:         MergeESC
Summary:      MergeESC misses ghost fields, sets ghost field(s) on incorrect object
Severity:     Medium
Status:       New
Reproducible: Yes
Description:

[mistere]
In the RatTermVec project, the copy method is merged as follows:

    ...

    public RatTermVec copy() {
        RatTermVec tv = new RatTermVec();
        tv.wrapped = (ArrayList) this.wrapped.clone();
        /*@ set wrapped.elementType = \type(PolyCalc.RatTerm) */
        /*@ set wrapped.owner = this */
        return tv;
    }

    ...

In fact, the @set statements should apply to the 'tv' object, and not
(implicitly) to the 'this' object.  Note also that the owner
annotation should state that the 'tv.wrapped.owner = tv', not
'this.wrapped.owner = this'.

Furthermore, set statements for the containsNull field are never
merged, either in copy or in the constructor.  Correct output would
be (with a ! indicating an added or changed line):

    ...

!   public RatTermVec() { wrapped = new ArrayList(); /*@ set wrapped.containsNull = false */
!                                                    /*@ set wrapped.elementType = \type(PolyCalc.RatTerm) */
                                                     /*@ set wrapped.owner = this */
                                                     }

    ...

    public RatTermVec copy() {
        RatTermVec tv = new RatTermVec();
        tv.wrapped = (ArrayList) this.wrapped.clone();
!	/*@ set tv.wrapped.containsNull == false */
!       /*@ set tv.wrapped.elementType = \type(PolyCalc.RatTerm) */
!       /*@ set tv.wrapped.owner = tv */
        return tv;
    }

    ...

These errors prevent verification of the class.

--
$Log$
Revision 1.3  2002-03-27 22:00:42  mistere
changed bug0031

Revision 1.2  2002/03/27 21:48:52  mistere
changed bug0031

Revision 1.1  2002/03/27 21:42:00  mistere
new bug0031

