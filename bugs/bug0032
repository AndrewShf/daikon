Version:      $Id$
Owner:        Toh <tohn>, Jeremy <mistere>
Tool:         Daikon v3
Summary:      Static final constants and enumnerated constants not handled properly
Severity:     Vexing
Status:       Closed
Reproducible: Yes
Description:

[tohn]
Fixed and closed.

[mistere]
I have made a fix to FileIO that should solve the problem.  The code
was also wrong in V2, but was never exercised since derived variables
were added in passes after reading the data.  The fix works for Fib.
Toh, please test on your IOA programs and change bug status to Closed
if everything is swell.

[tohn]
Daikon v3 will throw the following exception when given input that
involves using the "constant" convention in dtrace files:

**************************************************
*                     WARNING                    *
**************************************************
* You are using the REDESIGN version (V3) of the *
* Daikon engine. Make sure this is what you want.*
**************************************************
Inv filename = Fib.inv
Reading declaration files . (read 1 file)
Processing trace data; reading 1 file:
Exception in thread "main" java.lang.ArrayIndexOutOfBoundsException
	at daikon.PptTopLevel.add_and_flow(PptTopLevel.java:610)
	at daikon.FileIO.read_data_trace_file(FileIO.java:606)
	at daikon.FileIO.read_data_trace_files(FileIO.java:439)
	at daikon.Daikon.process_data(Daikon.java:560)
	at daikon.Daikon.main(Daikon.java:187)


The constant convention is a line in the decls file like:

Fib.x
int
int = 1
22


Just giving the decls file doesn't trigger the RuntimeException.
Giving the decls file and dtrace file does.

The bug can be reproduced with the following source:


class Fib extends Object {
  public static final int x = 1;

  public static int a, b, c;

  public static void main(String[] args) {
    a = 0;
    b = c = 1;
    for (int i = 0; i < 20; i++) {
      increment();
    }

  }

  public static void increment() {
    a = b;
    b = c;
    c = a + b;
  }


}


When references to x are removed in decls and dtrace, Daikon runs
properly.  Dtrace and decls files that show the bug can also be found
at ~tohn/test/enum.

This constant convention is used for static constants in Java, and for
enumerated data types in IOA.

--
$Log$
Revision 1.3  2002-03-28 02:48:09  tohn
changed bug0032

Revision 1.2  2002/03/27 23:30:23  mistere
changed bug0032

Revision 1.1  2002/03/27 21:59:09  tohn
new bug0032

