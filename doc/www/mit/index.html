<html>
<head>
<TITLE>Using Daikon at MIT LCS</TITLE>
<link rev="made" href="mailto:mernst@lcs.mit.edu">
</head>
<body>

<h1>Using Daikon at MIT LCS</h1>

This document tells you how to get started using Daikon on
geyer.lcs.mit.edu at the MIT Lab for Computer Science.  (These steps are
primarily for students and other colleagues working with Michael Ernst; if
you do not need access to the central repository of code and data, you can
simply <a href="../download">download</a> the Daikon distribution to your
own computer.)

<p>
The steps are simple, but there are many of them.  You
might wish to print this out (along with the <a
href="../download/doc/daikon.html">Daikon manual</a>) and check off items as
you ensure that they are correct.
<p>

You should already be familiar with <a href="../">the Daikon homepage</a>
and <a href="../download/">the Daikon distribution</a>.  See the <a
href="../download/doc/daikon.html">Daikon manual</a> for more details.
<p>

Contents: <!-- auto-generated by html-toc -->
    <ul>
      <li><a href="#learning-about-daikon">Learning about Daikon</a>
      <li><a href="#getting-account">Getting a computer account</a>
      <li><a href="#environment-1">Setting up your environment (part 1, before installing Daikon)</a>
        <ul>
          <li><a href="#classpath">Classpath</a>
        </ul>
      <li><a href="#getting-daikon">Getting your copy of Daikon</a>
        <ul>
          <li><a href="#local-cvs">Local CVS</a>
          <li><a href="#remote-cvs">Remote CVS</a>
          <li><a href="#using-cvs">Using CVS</a>
        </ul>
      <li><a href="#packages-used-by-daikon">Packages used by Daikon</a>
      <li><a href="#environment-2">Setting up your environment (part 2, after installing Daikon)</a>
      <li><a href="#running-daikon">Running Daikon</a>
      <li><a href="#editing-daikon.texinfo">Editing daikon.texinfo</a>
      <li><a href="#admin">Administrative details</a>
      <li><a href="#code-conventions">Coding conventions</a>
    </ul>
<p>

<h2><a name="learning-about-daikon"></a>Learning about Daikon</h2>

In order to become familiar with the theory of dynamic invariant detection
and some details of the Daikon implementation, see the following papers:
<ul>
  <li><a href="http://sdg.lcs.mit.edu/~mernst/pubs/invariants-tse-abstract.html">Dynamically
      Discovering Likely Program Invariants to Support Program
      Evolution</a> (IEEE TSE, v27#2, Feb 2001, pp 1-25)<br>
      I call this "the invariants paper" as it was the first exposition of
      the idea of dynamic invariant detection.  The first four and last
      three sections are more important than the middle four; you might
      want to skim the latter if you are short on time.
  <li><a href="http://sdg.lcs.mit.edu/~mernst/pubs/invariants-icse2000-abstract.html">Quickly Detecting Relevant Program Invariants</a> (ICSE 2000)<br>
      I call this "the relevance paper"; it discusses essential
      improvements to the basic technique.
  <li><a href="http://sdg.lcs.mit.edu/~mernst/pubs/invariants-pointers-abstract.html">Dynamically
      Discovering Pointer-Based Program Invariants (Technical Report, 2000)</a><br>
      I call this "the pointers paper"; it shows how to deal with recursive
      data structures.  It isn't as fundamental as the previous two.
</ul>
<p>


<h2><a name="getting-account"></a>Getting a computer account</h2>

geyer.lcs.mit.edu, also known as sdg.lcs.mit.edu, has plenty of disk space
and direct access to the main CVS repository and precompiled binaries.  You
are also welcome to work from elsewhere if you prefer.  Other machines you
may use include: potato, otto.  These machines are in room 413, to which
you should obtain a key (get the required form from Neena Lyall in room
523); or, you can use them remotely.
<p>

Do not use standard telnet or rlogin to log into geyer (or other machines)
remotely; always use ssh.  Similarly, for file transfer, use anonymous
means or use scp.  The ssh and scp programs protect your password from
eavesdroppers; we don't want geyer to get broken into due to negligence.
To change your password, use the <tt>yppasswd</tt> command; do not use
plain <tt>passwd</tt>.
<p>

Ask <a href="mailto:mernst@lcs.mit.edu">Michael Ernst</a> or someone else
with sysadmin privileges to make you an account; be sure to specify the
username you prefer.  Only that person needs to know the <a
href="geyer-account.html">details of account creation</a>.
<p>


<h2><a name="environment-1"></a>Setting up your environment (part 1, before installing Daikon)</h2>

By default, your account will use bash as its shell.  To use another shell,
run the <tt>chsh</tt> command; for instance, <tt>chsh /bin/tcsh</tt>.
<p>

You may wish to create a <tt>.forward</tt> file; its content is an email
address to which to redirect mail sent to
<em>yourusername</em>@{sdg,geyer}.lcs.mit.edu.  Mail to
<em>yourusername</em>@lcs.mit.edu should already be set to forward to 
<em>yourusername</em>@mit.edu (whoever creates your account will take care
of this).<p>

For compiling Java programs, you may wish to use <tt>jikes</tt> instead of
<tt>javac</tt>.  Jikes tends to be faster than javac.  If you have any
problems with it, you can always fall back to using javac.<p>

It is important that you be a member of the "invariants" Unix group.  (Run
the command <tt>groups</tt> to see which ones you are in.)  If you are not
in these groups, you cannot access the CVS repository.<p>

I recommend that you use the latest possible version of the JDK (Java
Development Kit).  A link to this  can always be found at
<tt>~mernst/java/jdk</tt>; you probably want to put the
<tt>bin</tt> subdirectory in your path and to add 
<tt>jre/lib/rt.jar</tt> to the end of your CLASSPATH:
<pre>
  set path = ( /g2/users/mernst/java/jdk/bin $path )
  setenv CLASSPATH ${CLASSPATH}:/g2/users/mernst/java/jdk/jre/lib/rt.jar
</pre>
<p>

Stable versions of both <tt>dfej</tt> and <tt>dfec</tt> (the Daikon Front
End for Java) appear in 
<tt>~mernst/research/invariants/binaries</tt>.  You should put that
directory on your path or make links to those binaries from a directory on
your path.  (The development version of <tt>dfej</tt>, the Daikon Front End
for Java, is available via CVS, and one checked-out version appears in
<tt>~mernst/research/invariants/dfej/src/</tt>.)
<p>

If you wish to run <tt>dfej</tt> on geyer, then you will need to adjust
your LD_LIBRARY_PATH environment variable.  A reasonable setting (csh
syntax; this would go in your <tt>.cshrc</tt> file) is
<blockquote>
<pre>
setenv LD_LIBRARY_PATH   /usr/X11R6/lib:/usr/local/lib:/usr/lib:/lib
</pre>
</blockquote>
<p>

Michael Ernst's work related to invariant inference is in
<tt>~mernst/research/invariants/</tt>.  Many, but not all, of the files
under that directory are under CVS version control.  Feel free to look
around, and also see my dotfiles, such as <tt>~mernst/.cshrc</tt>, for
potential customizations (but don't go overboard by copying everything
there).<p>

To make CVS produce diffs in "unified format", and to make CVS create
directories that exist in the repository but are missing from the working
directory, create a file in your home directory named <tt>.cvsrc</tt>
containing the following contents:
<blockquote>
<pre>
diff -u
update -d -P
</pre>
</blockquote>
or just <a href=".cvsrc">download this one</a> to your home directory.
<p>


<h3><a name="classpath"></a>Classpath</h3>

(by Jeremy Nimmer)
<p>

In case anyone is curious, this is how I set my CLASSPATH.  If you use this,
you should change $INV to where your CVS checkout of <tt>invariants</tt> is.
<p>

<pre>
setenv INV ${HOME}/research/invariants
setenv JAVA_HOME /g2/users/mernst/java/jdk
setenv RTJAR ${JAVA_HOME}/jre/lib/rt.jar
setenv DAIKON_LIBS `/usr/bin/perl -e 'print join(":", @ARGV);' ${INV}/java/lib/*.jar`
setenv CLASSPATH .:${INV}/java:${DAIKON_LIBS}:${RTJAR}
</pre>

This includes on your path:
<pre>
  .            - the cwd
  $INV/java    - your current checkout of daikon engine
  $DAIKON_LIBS - all of the .jar files in $INV/java/lib
  $RTJAR       - the JDK runtime (for jikes)
</pre>


<h2><a name="getting-daikon"></a>Getting your copy of Daikon</h2>

You can always download and install Daikon from its .tar.gz distribution.
Alternately, you can check out a copy of the system from the CVS
repository.
<!--  (A third option is to add <tt>~mernst/java</tt> or some other
installation to your Java classpath.  This is easy, but is deprecated,
because it does not permit you to modify the system and it does not
insulate you from incompatible changes or partial work of others.)
-->
<p>

Checking out Daikon from the CVS repository has several advantages:
<ul>
  <li>You will have access to a number of files intended for developer use
      which are not present in the distribution.
  <li>It is very easy to update to the latest version of the software,
      retaining any personal customizations you have made.
  <li>You can make changes and incorporate them in the master version of
      Daikon. 
</ul><p>

There are two modules (directories) available via anonymous CVS from
sdg.lcs.mit.edu:  <tt>invariants</tt> (the bulk of the Daikon invariant
detection system, which is written in Java) and <tt>dfej</tt> (the Daikon
front end for Java, which is written in C++).  If you obtain Daikon from
the CVS repository, you will also need to obtain some <a
href="#packages-used-by-daikon">additional packages</a> which are used by
Daikon but do not appear in the repository.
<p>

You can learn how to use CVS from
<a href="http://www.cvshome.org/new_users.html">CVS for new
users</a>, or the <a href="http://www.gnu.org/manual/cvs-1.9/cvs.html">CVS
manual</a> (<a
href="http://www.cvshome.org/docs/manual/index.html">alternate site</a>).
<p>

<h3><a name="local-cvs"></a>Local CVS</h3>

The following command creates and populates the <tt>invariants</tt> directory:
<pre>
    cvs -d /g4/projects/invariants/.CVS co invariants
</pre>
<p>

Optionally, you may check out a copy of the <tt>dfej</tt> directory.
You should not need to do this, however; just use the executable
<tt>~mernst/public_html/daikon/download/dfej-linux</tt>.  You should make a
link to that version from a directory on your path (or put that directory
on your path).  If you do check out the <tt>dfej</tt> directory, use this
command:
<pre>
    cvs -d /g4/projects/invariants/.CVS co dfej
</pre>
<p>


<h3><a name="remote-cvs"></a>Remote CVS</h3>

You can also create your copy of the repository on a remote machine (that
is, not geyer/sdg).  You can do so using anonymous CVS or regular CVS.
<ul>
  <li><a href="../anoncvs.html">Anonymous CVS instructions</a>
  <li><a href="../remote-cvs.html">Regular remote CVS instructions</a>.
      Also, see a description of <a
      href="http://www.cag.lcs.mit.edu/~rugina/ssh-procedures/">using ssh
      without password queries</a>.
</ul>
<p>


<h3><a name="using-cvs"></a>Using CVS</h3>

CVS permits multiple people to simultaneously edit (their own copy of) a
set of files, then merge the changes.  See the CVS manual to learn more.
The key commands are:
<dl>
  <dt><tt>cvs update -d</tt>
  <dd>update your version of the files from the repository
  <dt><tt>cvs diff</tt>
  <dd>show difference between your version and the repository
  <dt><tt>cvs add <i>FILENAME ...</i></tt>
  <dd>add a file to the repository (must also commit it)
  <dt><tt>cvs commit <i>[FILENAME ...]</i></tt>
  <dd>put your version of the file in the repository; don't forget to
      include a descriptive message regarding what changed
</dl>
I find it much easier to perform CVS manipulations in Emacs.  First, put
<tt>(autoload 'cvs-update "pcl-cvs" nil t)</tt> in your <tt>.emacs</tt> file.
Then, you can do <tt>M-x cvs-update</tt> to get a Dired-like listing of
(changed) files in the directory.  As with any Emacs mode, do
<tt>C-h m</tt> (help on mode) for details about how to use CVS mode in
Emacs.<p>


<h2><a name="packages-used-by-daikon"></a>Packages used by Daikon</h2>

Daikon relies on several other packages that appear in the <tt>java/lib</tt>
directory.  You will need to add those <tt>.jar</tt> files to your
classpath; for instance,
<pre>
  setenv CLASSPATH $HOME/research/invariants/java:$HOME/research/invariants/java/lib/jakarta-oro.jar:$HOME/research/invariants/java/lib/java-getopt.jar:$HOME/research/invariants/java/lib/junit.jar:$CLASSPATH
</pre>


<h2><a name="environment-2"></a>Setting up your environment (part 2, after installing Daikon)</h2>

In order to permit other members of the Daikon project to read your files,
you should either make them world-readable, or place them in the
<tt>invariants</tt> group and make them group-readable.  You may or may not
need to re-run the following commands periodically to ensure that new files
are readable, depending on how your environment and editor are set up.
<blockquote>
<pre>
## <em>Do this just once</em>
chmod +r ~
## <em>Do one of the following for each directory the group should be able to read</em>
# <em>To make a directory world-readable:</em>
chmod -R +r <em>DIR</em>
# <em>To make a directory group-readable, run two commands:</em>
chmod -R g+r <em>DIR</em>
chgrp -R invariants <em>DIR</em>
</pre>
</blockquote>
<p>

A few other environment details:
<ul>
  <li>The <tt>invariants/java</tt> directory should appear in your Java
      classpath (see example above).
  <li>The <tt>invariants/scripts</tt> directory should appear in your Unix
      path.
  <li>The installed version of the <tt>jikes</tt> Java compiler in
      <tt>/usr/bin</tt> appears to be broken (as of 4/2/2001).
      If you wish to use Jikes, use the executable
      <tt>/g2/users/mernst/bin/Linux-i686/jikes</tt>.
  <li>Make sure that all the files in <tt>invariants/scripts</tt> are
      executable:
<pre>
	chmod a+x invariants/scripts/*
</pre>
  <li>You can receive an email notification whenever files (in particular
      directories of your choosing) are checked in.  To receive such
      notifications, edit
      <tt>/g4/projects/invariants/.CVS/CVSROOT/loginfo</tt>.  This file is
      under RCS control; in Emacs, do <tt>C-x C-q</tt> before editing it
      and again after editing it.
<p>
</ul>
<p>



<h2><a name="running-daikon"></a>Running Daikon</h2>

See the <a href="../download/doc/daikon.html">Daikon manual</a> for instructions.
<p>


<h2><a name="editing-daikon.texinfo"></a>Editing daikon.texinfo</h2>

The Daikon manual appears in <tt>doc/daikon.texinfo</tt>.  The manual is
written using the Texinfo formatting system, which makes it easy to produce
HTML, info, or printed (PostScript and PDF) output.

<p>
You can edit the manual using an ordinary text editor.  You can either
mimic the formatting commands that already appear in the manual or read the
<a href="http://texinfo.org">Texinfo documentation</a>.

<p>
If you wish to create a new section of the manual, insert two lines like
the following:
<blockquote>
<pre>
@node    Short title, Foo, Bar, Baz
@chapter Long title
</pre>
</blockquote>
where "Foo", "Bar", and "Baz" are arbitrary, you select the short and the
long titles (which may even be the same), and you may replace "@chapter" by
"@section", "@subsection", or "@subsubsection".

<p>
Then, just run <tt>make</tt> to update the menus and other cross-references
(including the "Foo" and "Bar" and "Baz").


<h2><a name="admin">Administrative details</a></h2>

Each week, each group member prepares a written progress report as a short
email message.  It only needs to be a couple paragraphs long and will
probably only take 15-30 minutes to compose, but it should explain what
you have accomplished, what you have learned, and what you plan to do
next.  This is very helpful both in permitting others to understand what
you have done, and also in focusing your attention on whether you have
been productive and keeping you on top of your progress.
<p>

The outcome of research -- whether at the UROP, M.Eng., or Ph.D. level --
should be a paper describing what was learned and disseminating that
knowledge for the benefit of other researchers and practitioners.  For
instance, a summer's work might result in a conference or workshop paper.
Please keep in mind where your results might be published and whether what
you are doing contributes to the state of knowledge (either directly or
indirectly).
<p>


<h2><a name="code-conventions">Coding conventions</a></h2>

When code has a consistent style, particularly within a single file but
also over an entire project, the code is much easier to read and
understand.  I don't wish to spend an excessive amount of time or energy
promulgating coding guidelines, but here are a few things to pay
attention to when you contribute to Daikon.
<p>

Please keep comments to 80 characters and code to 80 characters whenever
possible.  This makes it possible to print the code in a readable fashion
and also to read the code in a standard-sized window.
<p>

Every class should have a descriptive comment at the top -- perhaps just
one or two sentences, perhaps something more extensive.  This is very
important now that there are many people working on the project, as it will
help those people understand what a class is intended to do.  (It wasn't
always true for code written when there was only one person working on the
project; we will try to correct that code by stages.  If you have problem
with any code, definitely ask for help so the code and/or comments can be
improved.)
<p>

Place whitespace around the outside of grouping punctuation.  For instance,
use <tt>if (foo) bar;</tt> rather than <tt>if(foo)bar;</tt> and use
<tt>} else {</tt> rather than <tt>}else{</tt>.
<p>


<hr>
<a href="../">Daikon invariant detector</a><p>

<address>
  <a href="http://sdg.lcs.mit.edu/~mernst/">Michael Ernst</a>
</address>

</body>
</html>
