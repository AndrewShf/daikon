<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <title>Using Daikon at MIT CSAIL</title>
  <link rev="made" href="mailto:mernst@csail.mit.edu" />
</head>
<body>

<h1>Using Daikon at MIT CSAIL</h1> <!-- omit from toc -->

<p>
This document tells you how to get started using Daikon on the PAG machines
(all named after root vegetables) at MIT CSAIL.
These steps are primarily for students and other colleagues working with
Michael Ernst; if you do not need access to the central repository of code
and data, you can simply <a href="../download/">download</a> the Daikon
distribution to your own computer.
</p>

<p>
The steps are simple, but there are many of them.  You
might wish to print this out (along with the <a
href="../download/doc/">Daikon manual</a>) and check off items as
you ensure that they are correct.
</p>

<p>
You should already be familiar with <a href="../">the Daikon homepage</a>
and <a href="../download/">the Daikon distribution</a>.  See the <a
href="../download/doc/daikon.html">Daikon manual</a> for more details.
</p>

<p>
If you work in the Program Analysis Group, then you should also be
familiar with the <a
href="http://pag.csail.mit.edu/pag/logistics.html">logistics for work
at PAG</a>.  In particular these instructions assume that you are
using the pag startup files (pag-daikon.cshrc or pag-daikon.bashrc)
described on that page.  Among other things, those startup files
define the variables <tt>$pag</tt> (<tt>/afs/csail/group/pag</tt>) and
<tt>$inv</tt> (<tt>~/research/invariants</tt>) which are used in the
instructions below.
</p>

<p>Contents:</p>
<!-- start toc.  do not edit; run html-update-toc instead -->
    <ul>
      <li><a href="#getting-started">Getting started</a>
        <ul>
          <li><a href="#learning-about-daikon">Learning about Daikon</a></li>
          <li><a href="#pag-computers">PAG computers</a></li>
          <li><a href="#getting-daikon">Getting your copy of Daikon</a>
            <ul>
              <li><a href="#local-cvs">Local CVS</a></li>
              <li><a href="#remote-cvs">Remote CVS</a></li>
              <li><a href="#using-cvs">Using CVS</a></li>
            </ul></li>
          <li><a href="#environment">Notes on your environment</a></li>
        </ul></li>
      <li><a href="#running-daikon">Running Daikon</a></li>
      <li><a href="#scratch-directories">Large files and scratch directories</a></li>
      <li><a href="#editing-daikon">Editing Daikon source code</a>
        <ul>
          <li><a href="#Emacs-commands">Emacs commands</a></li>
          <li><a href="#editing-daikon.texinfo">Editing daikon.texinfo</a></li>
        </ul></li>
      <li><a href="#other-tasks">Other tasks</a>
        <ul>
          <li><a href="#regression-tests">Testing Daikon</a></li>
          <li><a href="#distribution">Making a distribution (a release)</a></li>
          <li><a href="#Mangel-Wurzel-linux">Building and testing Mangel-Wurzel on Linux</a></li>
          <li><a href="#Mangel-Wurzel-Windows">Building/testing Mangel-Wurzel on Windows</a></li>
          <li><a href="#purify-linux">Setting up Purify on Linux</a></li>
          <li><a href="#purify-windows">Setting up Purify on Windows</a></li>
          <li><a href="#EDG-front-end">EDG C++ front end</a></li>
          <li><a href="#vmware">Setting up VMWare</a></li>
          <li><a href="#windows-setup">Setting up Windows for Mangel-Wurzel</a></li>
        </ul></li>
    </ul>
<!-- end toc -->

<hr />
<h2><a name="getting-started"></a>Getting started</h2>

<h3><a name="learning-about-daikon"></a>Learning about Daikon</h3>

<p>
In order to become familiar with the theory of dynamic invariant detection
and some details of the Daikon implementation, see the following <a
href="http://pag.csail.mit.edu/~mernst/research/#Invariant_detection">papers</a>:
</p>
<ul>
  <li><a href="http://pag.csail.mit.edu/~mernst/pubs/invariants-tse2001-abstract.html">Dynamically
      Discovering Likely Program Invariants to Support Program
      Evolution</a> (IEEE TSE, v27#2, Feb 2001, pp 1-25)<br />
      I call this "the invariants paper" as it was the first exposition of
      the idea of dynamic invariant detection.  The first four and last
      three sections are more important than the middle four; you should
      skim or skip sections 5-8 on first reading.
  </li>
  <li><a href="http://pag.csail.mit.edu/~mernst/pubs/invariants-relevance-icse2000-abstract.html">Quickly Detecting Relevant Program Invariants</a> (ICSE 2000)<br />
      I call this "the relevance paper"; it discusses essential
      improvements to the basic technique.
  </li>
  <li><a href="http://pag.csail.mit.edu/~mernst/pubs/invariants-incremental-fse2004-abstract.html">Efficient incremental algorithms for dynamic detection of likely invariants</a> (FSE 2004)<br />
      I call this "the incremental paper"; it discusses how to make the
      system run fast in one pass, instead of making multiple passes over
      the data in batch mode.  It may be the best overall introduction.
  </li>
</ul>
<p>
There are additional papers that further discuss the technique and
its applications; which ones to read depends on your particular interest.
</p>


<h3><a name="pag-computers"></a>PAG computers</h3>

<p>
See the notes about <a
href="http://pag.csail.mit.edu/pag/logistics.html#pag-computers">PAG
computers</a>.
</p>

<p>
When you log in, you will encounter an error in your initial
<tt>.bashrc</tt> or <tt>.cshrc</tt> until you <a href="#local-cvs">check
out your copy of the CVS repository</a>.  (The error message will tell you
to perform the checkout.)
</p>


<h3><a name="getting-daikon"></a>Getting your copy of Daikon</h3>

<p>
(Note: when you first trying out Daikon, you can provide a valuable
perspective that we don't usually get:  we are so used to the system that
we don't even notice the annoying (or incorrect) aspects of the tools, and
the ambiguous, confusing, or missing parts of the documentation.  Please be
particularly vigilant when you start our so that you can make suggestions
for improving the tools, or come up with ideas that you might pursue
yourself.)
</p>

<p>
For work on the PAG machines, you should check out a copy of the system
from the CVS repository.  (This only needs to be done once, though you must
periodically update your copy via <tt>cvs update</tt>.)
Alternately, you can always download and install
Daikon from its .tar.gz distribution.
</p>

<p>
Checking out Daikon from the CVS repository has several advantages:
</p>
<ul>
  <li>You will have access to a number of files intended for developer use
      which are not present in the distribution.</li>
  <li>It is very easy to update to the latest version of the software,
      retaining any personal customizations you have made.</li>
  <li>You can make changes and incorporate them in the master version of
      Daikon.</li>
</ul>

<p>
There are several modules (directories) available via anonymous CVS from
pag.csail.mit.edu.  The key one is <tt>invariants</tt> (the bulk of the
Daikon invariant detection system, which is written in Java).
</p>

<p>
You can learn how to use CVS from
the <a href="http://ximbiot.com/cvs/manual/">CVS
manual</a>.
</p>

<h4><a name="local-cvs"></a>Local CVS</h4>

<p>
The following commands create and populate the
<tt>~/research/invariants</tt> directory.  Note that <tt>$pag</tt> is
defined in the pag-daikon startup files described in the <a
href="http://pag.csail.mit.edu/pag/logistics.html">logistics</a> file.

</p>
<pre>
    mkdir ~/research
    cd ~/research
    fs sa -d . .. -a pag-admin rl
    fs sa -d . .. -a pag rl
    cvs -d $pag/projects/invariants/.CVS co invariants
    cd invariants
    cp -p doc/www/mit/Makefile.user java/
    cd ~/research/invariants
    make compile
</pre>

<p>
Before trying to compile (via <tt>make</tt> in any directory under
<tt>~/research/invariants/java</tt>), log out and log back in, to set
up your environment.
</p>

<p>
You may also want the <tt>papers</tt> directory:
</p>
<pre>
    cd ~/research/invariants
    cvs -d $pag/projects/invariants/.CVS co papers
</pre>

<p>
If you want to instrument C programs, get Kvasir:
</p>
<pre>
    cd ~/research/invariants
    make build-kvasir
</pre>


<h4><a name="remote-cvs"></a>Remote CVS</h4>

<p>
You can also create your copy of the repository on a remote machine (that
is, not a PAG client machine).  You can do so using CVS.
</p>

<p>
You will need to set up your environment
properly on the remote machine.
(You don't have to worry about this step when using a local CVS checkout on
the CSAIL machines, because the
<tt>pag-daikon.</tt>{<tt>bashrc</tt>,<tt>cshrc</tt>} files do that for you.)
One difference from the instructions in the Daikon manual is that the
<tt>bin/</tt> subdirectory in the distribution is named <tt>scripts/</tt>
in the repository.
You can start by copy over your dotfiles or working from
the dotfiles in <tt>$inv/doc/www/mit/</tt> (such as
<tt>.bashrc</tt> or <tt>.cshrc</tt>).  You may
need to adjust some of their settings (such as the ones that refer to the
PAG filesystem).  Also ensure that you set the CVS_RSH environment variable
to "ssh" (without the quotes).
</p>

<p>
The command to check out the repository using regular remote CVS is:
</p>
<pre>
cvs -d :ext:<i>username</i>@pag.csail.mit.edu:/afs/csail.mit.edu/group/pag/projects/invariants/.CVS co invariants
</pre>
<p>
Other modules can be obtained by replacing the final
<tt>invariants</tt> (in the command line above) with another module name.
</p>

<p>
You may also need to install various extra packages, such as Simplify.
See the manual for details.
</p>

<p>
If you use Kerberos authentication on the remote machine, then you do not
have to type your password every time that you perform a CVS operation.
</p>


<h4><a name="using-cvs"></a>Using CVS</h4>

<p>
CVS permits multiple people to simultaneously edit (their own copy of) a
set of files, then merge the changes.  See the CVS manual to learn more.
The key commands are:
</p>
<dl>
  <dt><tt>cvs update -d</tt></dt>
  <dd>update your version of the files from the repository</dd>
  <dt><tt>cvs diff</tt></dt>
  <dd>show difference between your version and the repository (at the time
      you last updated)</dd>
  <dt><tt>cvs add <i>FILENAME ...</i></tt></dt>
  <dd>add a file to the repository (you must also commit it)</dd>
  <dt><tt>cvs commit <i>[FILENAME ...]</i></tt></dt>
  <dd>put your version of the file in the repository; don't forget to
      include a descriptive message regarding what changed</dd>
</dl>
<p>
I find it much easier to perform CVS manipulations in Emacs.  First, put
<tt>(autoload 'cvs-update "pcl-cvs" nil t)</tt> in your <tt>.emacs</tt> file.
Then, you can do <tt>M-x cvs-update</tt> to get a Dired-like listing of
(changed) files in the directory.  As with any Emacs mode, do
<tt>C-h m</tt> (help on mode) for details about how to use CVS mode in
Emacs.</p>

<p>
You should do <tt>cvs update</tt> frequently, in order to avoid conflicts
(where someone else has changed something that you have also changed).
Please commit your changes fairly regularly, too, so that others can take
advantage of your changes.  But always test your changes, never commit
changes unless the regression tests pass, and use a descriptive CVS comment
when you commit.
</p>


<h3><a name="environment"></a>Notes on your environment</h3>

<p>
By default, your account uses bash as its shell.  To use another shell, run
the <tt>chsh</tt> command (for instance, <tt>chsh -s /bin/tcsh</tt>), then log
out and log back in.
</p>

<p>
If you wish to use the Eclipse IDE, see the <a
href="eclipse-pag.html">instructions for using Eclipse at PAG</a>.
</p>

<p>
In order to permit other members of the Daikon project to read your files,
please make them readable by the <tt>pag</tt> group, as described on the <a
href="http://pag.csail.mit.edu/pag/logistics.html#pag-computers">PAG
computers</a>.
</p>

<!--
In order to permit other members of the Daikon project to read your files,
you should either make them world-readable, or place them in the
<tt>invariants</tt> group and make them group-readable.  You may or may not
need to re-run the following commands periodically to ensure that new files
are readable, depending on how your environment and editor are set up.
<blockquote>
<pre>
## <em>Do one of the following for each directory the group should be able to read</em>
# <em>To make a directory world-readable:</em>
chmod -R +rx <em>DIR</em>
# <em>To make a directory group-readable, run two commands:</em>
chmod -R g+rx <em>DIR</em>
chgrp -R invariants <em>DIR</em>
</pre>
</blockquote>
<p>
-->

<p>
A few other environment details:
</p>
<ul>
  <li>Make sure that all the files in <tt>invariants/scripts</tt> are
      executable:
<pre>
	chmod a+x invariants/scripts/*
</pre>
      (If everything is set up properly, they should be executable already
      when you check them out from the CVS repository.)
  </li>
  <li>You can receive an email notification whenever files (in particular
      directories of your choosing) are checked in.  To receive such
      notifications, edit
      <tt>$pag/projects/invariants/.CVS/CVSROOT/loginfo</tt>.  This file is
      under RCS control; in Emacs, do <tt>C-x C-q</tt> before editing it
      and again after editing it.  Note that some of the lists of email
      addresses are space-separated and others are comma-separated; be
      careful to use the proper separator.
  </li>
</ul>

<p>
Feel free to look at other people's dotfiles, such as
<tt>~<em>USER</em>/.cshrc</tt> and <tt>~<em>USER</em>/.emacs</tt>, for
potential customizations (but don't go overboard by copying everything you
find without understanding it).</p>


<hr />
<h2><a name="running-daikon"></a>Running Daikon</h2>

<p>
See the <a href="../download/doc/">Daikon manual</a> for instructions.
</p>

<hr />
<h2><a name="scratch-directories"></a>Large files and scratch directories</h2>

<p>
To avoid filling up our disks with very large files (and to avoid causing
backups to be made of those large files), avoid creating dtrace files in
your home directory; instead, use a temporary directory.  Each pag client
machine has two such directories:  /scratch and /scratch2.  These
directories are quite large (dozens of gigabytes) and are not backed up.
The pag machines allow cross-mounting of /scratch and /scratch2 from other
machines:
</p>
<pre>
  cd /var/autofs/net/<em>pag-client</em>/scratch
  cd /var/autofs/net/<em>pag-client</em>/scratch2
</pre>
<p>
Typically each group member creates a subdirectory called
<tt>/scratch/$USER/</tt> on some machine.
</p>

<p>
To ensure that dtrace files are created on one of the scratch drives, you
can specify an absolute pathname for the trace file, or you can run your
experiments in a scratch directory, or you can use the makefiles in the
$inv/tests/ directory, which automatically put dtrace files on scratch
drives.  Another advantage of using the makefiles is that it is easy to set
up and ensures that all the required steps are performed in the proper
order, in an easily reproducible way.
</p>

<p>
You should almost specify a trace file name that includes <tt>.gz</tt> at the end;
see the <tt>--dtrace-file=FILENAME</tt> argument to Chicory, Kvasir, or Mangel-Wurzel, or the DTRACEFILE
environment variable.  (This is the default if you don't specify a filename.)
</p>


<hr />
<h2><a name="editing-daikon">Editing Daikon source code</a></h2>

<p>
Important:  see the <a
href="http://pag.csail.mit.edu/pag/logistics.html#code-conventions">PAG
coding conventions</a>.
</p>

<h3><a name="Emacs-commands">Emacs commands</a></h3>

<p>
The command <tt>M-x daikon-tags-table</tt> sets up Emacs to use the Daikon
TAGS table, which lets you easily find definitions and search through the
entire codebase in Emacs.  (You need to run this command once per instance
of Emacs.)
</p>

<p>
The commands <tt>M-x daikon-info</tt> and <tt>M-x
daikon-developer-info</tt> view the Daikon manual and the Daikon Developer
manual using the Info
viewer within Emacs.  These commands also update all other versions of the
manuals (HTML, PDF, etc.).
You may also choose to use the stand-alone Info viewer, to
use a Web browser to read the manual in HTML form, or to read the
PostScript or PDF version either electronically or on paper.
</p>


<!-- No <tt>...</tt> around "daikon.texinfo" due to bad HTML rendering. -->
<h3><a name="editing-daikon.texinfo"></a>Editing daikon.texinfo</h3>

<p>
The Daikon manual appears in <tt>doc/daikon.texinfo</tt>.  The manual is
written using the Texinfo formatting system, which makes it easy to produce
HTML, info, or printed (PostScript and PDF) output.
</p>

<p>
You can edit the manual using an ordinary text editor.  Emacs has a
useful Texinfo mode.  You can mimic the formatting commands that 
already appear in the manual, but it's also a good idea to read the
<a href="http://texinfo.org">Texinfo documentation</a>.
</p>

<p>
If you wish to create a new section of the manual, insert two lines like
the following:
</p>
<blockquote>
<pre>
@node    <em>Short title</em>, Foo, Bar, Baz
@<em>chapter</em> <em>Long title</em>
</pre>
</blockquote>
<p>
where you should insert "Foo, Bar, Baz" literally (they will be fixed up
for you automatically), you select the short and the long titles (which may
even be the same), and you may replace "@chapter" by "@section",
"@subsection", or "@subsubsection".
</p>

<p>
Follow the Texinfo conventions for marking up text.  In particular:
</p>
<ul>
  <li> Don't use regular double quotes (&quot;) in running text.  Instead, use 
  two single backquotes and two regular quotes, ``like this''.  Emacs will
  do this substitution for you if you are using its Texinfo mode.</li>

  <li> Often, some other kind of markup is better than quotes:
    <ul>
      <li>@code is for names of classes, functions, variables, keywords, and
      other fragments of source code.</li>
      <li>@var is for meta-syntactic variables, not for referring to variables 
      that appear literally in the source code.</li>
      <li>@file is for the names of files.</li>
      <li>@option is for command-line options.</li>
      <li>@samp is for sample input or output.  (Alternatively, you can use
      @example to set off longer input/output strings.)</li>
      <li>@command should be avoided.  If you are referring to the program 
      itself, just use the name of the program without special markup, e.g. GCC.
      If you are referring to how to invoke the program from the shell, 
      @samp is better, e.g. @samp{gcc -E}.</li>
    </ul>
  </li>
  <li>Examples shouldn't include extra spaces on the left for 
    indentation since Texinfo already adds some indentation.  Remember 
    that in code examples you need to replace all curly braces with @{ and @} 
    to quote them for Texinfo.
  </li>
  <li>Don't mix @example and @smallexample in the same section since it
    looks funny to have examples in two different sized fonts.  If your example
    is too wide to fit on the page with @example, it's better to insert some
    line breaks to make it more readable than to shrink the font.
  </li>
  </ul>

<p>
Once you have edited the manual, run <tt>make</tt> twice (yes, you must run
it twice) in order to generate formatted versions of the manual
(<tt>daikon.</tt>{<tt>html,info,ps,pdf</tt>}).
</p>


<hr />
<h2><a name="other-tasks">Other tasks</a></h2>


<h3><a name="regression-tests">Testing Daikon</a></h3>

<p>
See the description of <a
href="http://pag.csail.mit.edu/daikon/download/doc/developer.html#Testing">Daikon's
tests</a> in the Daikon Developer Manual.  It is important that you
understand that Daikon has two sets of tests (unit tests and regression
tests), and that if any of these tests fails, you should not check in your
changes.
</p>

<p>
The regression tests run every night.  They should never fail, because it
is each developer's responsibility to run them before checking in code.  If
they do fail, then it is the responsibility of everyone who checked in code
in the previous day to collectively determine responsibility (this is often
obvious).  You can find out who has checked in since a given date with the
<tt>cvs history</tt> command:
</p>
<pre>
  cvs history -a -c -D "2005/03/08"
</pre>

<p>
It is the responsibility of the person who caused the failure to
fix it immediately; the regression tests should almost never fail two
nights in a row.  This is important to avoid masking subsequent errors
&mdash; the regression tests do no good while they are failing.  (And, you
should be ashamed if the regression tests fail at all!)
</p>

<p>
The cron job for the overnight tests appears in
<tt>$INV/scripts/buildtest.crontab</tt>, and is run as user
<tt>daikonuser</tt>.
</p>


<h3><a name="distribution">Making a distribution (a release)</a></h3>

<p>
To publish a Daikon distribution, do the following.  If you only want to
create the <tt>daikon.tar</tt> or <tt>daikon.tar.gz</tt> file in your own
directory, then simply run <tt>make</tt> with the desired file as the
target.
</p>

<ol>

    <li> It is suggested that you use the <tt>daikonuser</tt> account
    to publish a distribution.  This ensures that everything has been
    committed to CVS and that nothing extraneous in your account gets
    included in the distribution.  Ask a senior group member for the
    password.  Note that all of the following instructions should work
    from other accounts as well.

    <pre>
        su - daikonuser </pre>
    </li>

    <li> Update daikon in daikonuser to the most recent version.

    <pre>
        cd $inv
        cvs -q update -d
        cvs -q diff    </pre>

    <p>The <tt>cvs -q diff</tt> command should produce no output. </p>
    </li>

    <li> Rebuild everything.

    <pre>
        make rebuild-everything    </pre> 
    </li>

    <li> Run the kvasir regression tests
    <pre>
        make -C $inv/tests/kvasir-tests    </pre>
    </li>

    <li> Run the regression tests.
         The last line printed should be "All tests succeeded."

    <pre>
        make -C $inv/tests clean diffs </pre>
    </li>

    <li> Edit the <tt>doc/CHANGES</tt> file to indicate what has changed
    in this version.  A good way to determine what has changed is to diff
    the texinfo source files in the doc directory against the previous
    versions:

    <pre>
        cd $inv/doc
        diff -b -u -s --from-file /afs/csail/group/pag/docroot/www.pag.csail.mit.edu/daikon/dist/doc *.texinfo </pre> 

    <p>Another good source of information is the cvs logs over the
    last month: </p>

    <pre>
	cd $inv/java
	cvs -q log -d ">1 month ago" -N | cvs-log-summarize.pl    </pre>
    </li>

    <li> <p> Set the distribution date and version number.  The date will
    be set to today, but can be overridden by redefining environment
    variable TODAY (e.g., 'TODAY=November 1 2004').  The version is
    specified in the file $inv/doc/VERSION </p>

    <pre>
	cd $inv
	make update-doc-dist-date-and-version    </pre>
    </li>

    <li> <p>Build everything to be distributed and copy it to the staging
    area (www.pag.csai.mit.edu/daikon/staging-daikon).  The final
    output will be a list of files that were added/removed since the
    last release.</p>

    <pre>
        make staging    </pre>
    </li>

    <li> Test the distribution in the staging area.  The last part of
    the test runs Chicory/Daikon on the StackAr example in the
    release.  Success is indicated by invariant output being written
    to the screen. <b>Consider moving the staging area to the website
    so that we can check things out via the webserver before
    installing.</b>

    <pre>
        make test-staged-dist    </pre>
    </li>

    <li> Update the website. 

    <pre>
        make staging-to-www
        make pag-install </pre> 

    <p>
    Note that <code>make staging-to-www</code> will automatically
    update the version numbers in the source code and documentation
    from the file <tt>doc/VERSION</tt>.  After doing so, it will
    correctly update the version number in <tt>doc/VERSION</tt>.  This
    should not require any hand intervention unless there is a problem
    near the end of building the distribution and the <code>make
    update-doc-dist-date-and-version </code> command has to be run
    again after the version number has been incremented.  In this
    case, simply edit <tt>doc/VERSION</tt> by hand back to the correct
    version number before rebuilding. </p>

    <p>
    <b>We should consider just updating the version number by hand at the
    beginning of the process.  That way we can run this multiple times without
    confusion.</b> </p>
    </li>

    <li> Check the website to see if it has any broken links

    <pre>
      checklink.pl -q -r `cat $inv/scripts/checklink-args.txt` http://pag.csail.mit.edu/daikon </pre>
    </li>

    <li> Commit any changes back to CVS 

    <pre>
        cd $inv
        cvs -q commit -m "Change version to &lt;X.Y.Z>" </pre>
    </li>

    <li> Send mail to the daikon-announce mailing list.  There are sample
    messages in the <a href="https://lists.csail.mit.edu/pipermail/daikon-announce/">archive</a> of <a href="https://lists.csail.mit.edu/mailman/listinfo/daikon-announce/">daikon-announce</a>.

    <p>
    You may need to visit <a
    href="https://lists.csail.mit.edu/mailman/admindb/daikon-announce/">https://lists.csail.mit.edu/mailman/admindb/daikon-announce/</a>
    to approve the message before it is sent to the list.
    </p>
    </li>

    <li> Submit an update to
    freshmeat.net, which will inform others that a new release is available.

    <p>
    (In order to perform this step, you need to be an admin for the <a
    href="http://freshmeat.net/projects/daikon/">Daikon project at
    freshmeat.net</a>.  If you are not, ask one of the current admins
    to add you to the list.)
    </p>

    Go to the <a
    href="http://freshmeat.net/projects/daikon/">Daikon project</a> and 
    choose 'add releases' which is the first choice next to [Project].
    There enter the version number, type of release and the introductory
    paragraph from CHANGES for this release. <p> 

    This could be automated.  See "man freshmeat-submit" or
    <a href="file:///afs/csail/group/pag/software/pkg/freshmeat-submit-1.6/freshmeat-submit.html">file:///afs/csail/group/pag/software/pkg/freshmeat-submit-1.6/freshmeat-submit.html</a>. 
    </p>
    </li>
</ol>


<h3><a name="Mangel-Wurzel-linux">Building and testing Mangel-Wurzel on Linux</a></h3>

<ol>

    <li> Checkout Mangel-Wurzel from CVS (if necessary)
    <pre>
    cd $inv
    cvs -d $pag/projects/invariants/.CVS co mangel-wurzel </pre>

    (Before doing this step, you should have signed an <a
    href="#EDG-front-end">EDG non-disclosure agreement</a>.)
    </li>

    <li> Update Mangel-Wurzel
    <pre>
    cd $inv/mangel-wurzel
    cvs -q update </pre> 
    </li>

    <li> Setup yourself to use Purify and switch over the license (if
    necessary) to you as described <a href="#purify-linux"> below</a>.
    </li>

    <!-- These should not be necessary they are in the makefile    </li>

    <li> Set the environment variable <code>PURIFY_DIR</code> to
    <code>$RATIONAL/releases/purify.i386_linux2.2003a.06.15/</code>.<p>
    </li>

    <li> Set the environment variable <code>MANGEL_DIR</code> to
    <code>$inv/mangel-wurzel</code>.<p>
    </li>

    <li> Add <code>$inv/mangel-wurzel/bin</code> to your path.<p>
    -->

    <li> Build and test Mangel-Wurzel.
    <pre>
    cd $inv/mangel-wurzel;
    make install
    make test </pre>
    </li>

    <li> To make and copy new binary distribution for release:
    <pre>
    make tar 
    make release</pre>
    </li>
</ol>



<h3><a name="Mangel-Wurzel-Windows">Building/testing Mangel-Wurzel on Windows</a></h3>
<ol>

    <li> Startup VMWare on horseradish
    </li>

    <li> Checkout mangel-wurzel from CVS (if necessary)
    <pre>
    cd $inv
    cvs -d :ext:username@pag.csail.mit.edu:/afs/csail.mit.edu/group/pag/projects/invariants/.CVS co mangel-wurzel </pre>
    </li>

    <li> Update mangel-wurzel
    <pre>
    cd $inv/mangel-wurzel
    cvs -q update </pre>
    </li>

    <li> Make sure that the mangel is setup for windows
    <pre>
    cd $inv/mangel-wurzel
    cp .mangelrc.windows .mangelrc </pre>
    </li>

    <li> Setup yourself to use purify and switch over the license (if
    necessary) to you as described <a
    href="#purify-windows-change-user"> below</a>.
    </li>

    <li> Build and test mangel-wurzel
    <pre>
    cd $inv/mangel-wurzel
    make install
    make test </pre>

    There will be differences in the md5, rijndael, and unit directories,
    because of differences between the unix and windows versions.
    </li>

    <li> Create a zip file and release it
    <pre>
    make zip
    cp mangel-wurzel-windows.zip /afs/csail/group/pag/www/daikon/download/binaries </pre>

    Note that the vmware box probably doesn't have direct access to
    afs, so the above cp command will have to me modified accordingly.
    </li>
</ol>

<p>
Problems:
</p>
<ul>

    <li> 
    When running the tests, the error '<code>Expected
    HOST_ALIGNMENT_REQUIRED is 8</code>' is seen.
    <br />
    Probably, the  file <code>misc/dettargs.out</code> has been
    created incorrectly.  Try going to the <code>misc</code> subdirectory,
    deleting the files <code>lldef</code> and<code>dettargs.out</code>
    and then rebuilding dettargs.out (<code>makedettargs.out</code>).
    </li>

    <li>
    When running the tests, the first test hangs or encounters
    illegal instructions.
    <br />
    Look to see what command is being used to compile the intermediate
    file.  The command on windows should be 'cl'.  If it is 'cc', the
    <code>.mangelrc</code> file (that controls defaults) is not set
    correctly.  Make sure that <code>.mangelrc</code> in $MANGEL_DIR
    has the same contents as does <code>.mangelrc.windows</code> (in
    the same directory)
    </li>
</ul>

<h3><a name="purify-linux">Setting up Purify on Linux</a></h3>

<p>
Currently, we only have a single-user, single-machine license for Purify, and
you can only run it on horseradish (unless you transfer the license to 
another machine).  Purify itself is installed in the group directories:
</p>

    <pre>
    /afs/csail.mit.edu/group/pag/software/pkg/Rational
    /afs/csail.mit.edu/group/pag/software/pkg/PurifyPlus.2003a.06.15</pre>

<p>
To run it:
</p>

<ol>

    <li> Set the environment variable <code>RATIONAL</code> to
    <code> /afs/csail.mit.edu/group/pag/software/pkg/Rational </code>.
    </li>

    <li> Add the Purify bin directory 
    (<code>$RATIONAL/releases/PurifyPlus.2003a.06.15/i386_linux2/bin</code>) 
    to your path.
    </li>

    <li> Test to see you have a license:
    <pre>
    $RATIONAL/releases/PurifyPlus.2003a.06.15/i386_linux2/bin/purify -testlicense </pre>
    </li>
</ol>

<p>
To change the authorized user:
</p>
<ol>
    <li> Go to <code>$RATIONAL/config</code> and edit
    <code>rational.opt</code> to have your login name as the authorized
    user.
    </li>

    <li> Restart the license manager:<pre> 
    cd $RATIONAL/config
    ./start_lmgrd_on_horseradish stop
    ./start_lmgrd_on_horseradish </pre>
    </li>
</ol>

<p>
To move the license to a different machine:
</p>

<ol>

    <li> Go to <a href="http://www.ibm.com/software/rational/support/licensing/">http://www.ibm.com/software/rational/support/licensing/</a> 
    and create an account with
    your e-mail address.  Our account number is M211806-0-303 and our IBM
    customer number is 5549887.
    </li>

    <li> Once you have logged in, get a license key using the link to
    "Request and Manage License Keys".  We have a named user floating
    license.  The key is specific to the machine you want to install
    Purify on, so if you want to move Purify to a different machine,
    you need to return the old key (for horseradish) and request a new
    one.
    <br />
    The current license file is 
    <code>$RATIONAL/config/license_for_horseradish.upd</code>.
    </li>

    <li> Install the new license key into Purify by running the script
    <code>$RATIONAL/releases/PurifyPlus.2003a.06.15/rs_install</code>.
    This script will walk you through a series of menus; if you aren't
    sure what step to do next, just choose the default.  Look for the option
    to install a new permanent license, and then the option to import a license
    from an <code>.upd</code> file.
    </li>
</ol>

<h3><a name="purify-windows">Setting up Purify on Windows</a></h3>

<p>
As on Linux, we currently have only a single-user, single-machine license
for Purify on Windows, currently set up to run on a VMWare virtual machine
installed on horseradish in <code>/scratch/vmware/</code>.
</p>

<p>
To install Purify from scratch:
</p>
<ol>
    <li> Go to <a href="http://www.rational.com/licensing">http://www.rational.com/licensing</a>
     and create an account with
    your e-mail address.  Our account number is N218469-0-245 and our IBM
    customer number is 5549887.
    </li>

    <li> Once you have logged in, get a license key using the link to
    "Request and Manage License Keys".  We have a named user floating
    license.  The key is specific to the machine you want to install
    Purify on, so if you want to move Purify to a different machine,
    you need to return the old key (for horseradish) and request a new
    one.
    </li>

    <li> Download PurifyPlus for Windows.  It'll ask you to run one program to
    download the files, then ask you to run the installer.  That'll start up
    the "Rational Setup Wizard".
    </li>

    <li> Tell the wizard to install the Rational License Server first.
    That will start up another wizard to set up the license server.
    Just go through the menus and accept all the defaults.
    </li>

    <li> When that finishes, it'll start up the License Key
    Administrator Wizard.  Choose the option to Import a Rational
    License File, and point it at the license key you downloaded in
    step (2).
    </li>

    <li> Next it'll ask you to edit the options file.  You only need one
    line in the file, like 

    <pre>
    INCLUDE PurifyNT USER sjl </pre>

    where "sjl" is the login name of the user authorized to run
    Purify.  If the login name includes spaces, wrap it in double quotes.
    </li>

    <li> Use the dialog box to restart the license server, then exit from
    the Rational License Key Administrator.
    </li>

    <li> Now you have to go back and install PurifyPlus.  To do this, use the
    desktop file browser to go to
    <pre>
    C:\Program Files\PurifyPlus&nbsp;for&nbsp;Windows\SETUP\</pre>
    and then open "purifyplusNT Setup Launcher".  Choose Rational Purify as
    the product to install (our license doesn't include PureCoverage or 
    Quantify).  This will throw you back into the License Key Administrator
    again, but you don't have to do anything here.
    </li>

    <li> At this point, you should be able to start up Purify from the "All
    Programs" button on the "Start" menu on your toolbar.  Ta-da!
    </li>
</ol>


<a name="purify-windows-change-user"> To change the authorized user: </a>
<ol>

    <li> Go into <code>C:\Program&nbsp;Files\Rational\Common</code> 
    and edit <code>Rational.opt</code> (make
    sure it is the one listed as an OPT file and not a text file).  If 
    your username includes spaces, be sure to enclose it in "double quotes". 
    </li>

    <li> From the Windows Control Panel, go to Performance and Maintenance,
    then Administrative Tools, and then pick "Services".  From this
    menu, restart the "FLEXlm License Manager".  (In a pinch, you can
    also reboot the machine to force the license server to restart and
    read the new options file.)
    </li>
</ol>

<p>
To move the license to another machine:</p>
<ol>
    <li> Fire up the "Rational Licence Key Administrator" from the Start
    menu and use the wizard for "Get, Return, or Move Keys".  It'll
    send you to the Rational web site to return the existing license
    key and get a new one.
    </li>

    <li> Then follow the instructions above for a scratch installation on the
    new machine.
    </li>
</ol>


<h3><a name="EDG-front-end">EDG C++ front end</a></h3>

<p>
The <a href="http://www.edg.com/index.php?location=c_frontend">EDG C++ Front End</a> is a parser
for C and C++.  It is the basis of the Mangel-Wurzel front end for Daikon.
</p>

<p>
Reading the code of the EDG C++ Front End (and therefore any work on
Mangel-Wurzel) requires signing a <a
href="edg-nda-noncomm.pdf">non-disclosure agreement</a>.
You just have to fill out pages 4 and 5; 
"Developer" is MIT, and "Programmer" is you.
<!-- This detail is no longer relevant with the form as of October 2005. -->
<!-- The "date of the original agreement" is August 16, 2000. -->
You should <a href="http://www.edg.com/index.php?location=contact_sales">fax</a> the signed
document back to EDG, give a copy to Michael Ernst, and retain a copy for
your own records.
</p>

<p>
We distribute Mangel-Wurzel in binary form, so users don't have to worry
about this issue at all (though they also don't get the source code to
Mangel-Wurzel unless they, too, have an EDG license).
</p>

<p>
If you are new to this code, start by reading its manual and by looking
at <code>src/il_def.h</code>.
</p>

<h3><a name="vmware"> Setting up VMWare </a></h3>

<ul>

    <li> The vmware executable is /usr/vmware/bin/vmware.  Normally its
    best to add /usr/vmware/bin to your path </li>

    <li> MIT has licenses for VMWare.  Send an email to software@csail.mit.edu
    to get a license number.  From the vmware screen, choose 
    'help->Enter Serial Number' to enter the license. </li>

    <li> Start up VMWare by choosing 'Open existing virtual machine or team'
    from the main window.  The setup (at least on horseradish) is found
    in /scratch/vmware (should we move this to a place that is backed up?) </li>

    <li> Using VMWare remotely may create some problems with mapping X
    keys correctly.  This is explained at: <a
    href="http://www.vmware.com/support/ws5/doc/ws_devices_keymap_linux_longer.html">
    the vmware support site</a>.  To use VNC I found I had to set the
    keyboard by hand.  To do this add 'xkeymap.language = us101' to
    your vmware config file (~/.vmware/config).  At that point
    everything worked except the vertical bar (|).  I fixed that be
    adding 'xkeymap.keysym.bar = 0x02b' to the config file. </li>
</ul>

<h3><a name="windows-setup"> Setting up Windows for Mangel-Wurzel</a></h3>

<p>Setting up your Windows environment:</p>
<ol>

<li> You need to come up with a good way to transfer files back and
forth between Linux and Windows.  If you're using VMWare, the easiest
way to do this is to import your home directory on Linux into Windows
as a shared folder/network drive.  To do this, you need to add the
directory on the Linux side to VMWare's list of shared folders (use
the "Virtual Machine Settings" menu), then on the Windows side, go
into the "Tools" menu tab in the file browser and select "Map network
drive".  You do not need to install CVS on Windows as long as you can
easily copy tarballs back and forth.</li>

<li> You need to have all of these installed on your Windows box:
Cygwin, Daikon, the JDK (because Daikon uses some stuff that isn't
included in the JRE), Rational Purify, and Visual C/C++.</li>

<li> It's helpful for copying files back and forth if you create
shortcuts to both your Cygwin and Linux home directories from your
desktop, and/or a symbolic link in your Cygwin home directory to your
shared Linux directory.</li>

<li> Although MW runs as a native Windows application, building it
requires Cygwin and particularly Gnu Make.  However, be aware that you
can't run MW from inside an XTerm window -- you need to be in a
Windows console window, like the shell window you get when you
double-click on the Cygwin icon.  (This is a restriction of Rational
Purify, which doesn't work correctly if console input/output is
redirected to/from a pipe, which is how ptys are implemented in
Cygwin.)  Also note that Purify only works on native Windows
executables produced by the Visual C/C++ compiler, not by gcc.</li>

<li> You need to set up some environment variables in your 
<code>.cshrc</code> or <code>.bashrc</code>,  like so:

<p>For Daikon:</p>
<pre>
setenv CLASSPATH '.;C:\Program Files\daikon\daikon.jar;C:\Program Files\Java\jdk1.5.0_05\lib\tools.jar'
</pre>

<p>For Visual C/C++:</p>
<pre>
setenv MVSDIR "C:\Program Files\Microsoft Visual Studio .NET 2003"
setenv INCLUDE "$MVSDIR\Vc7\include;$MVSDIR\Vc7\PlatformSDK\Include"
setenv LIB  "$MVSDIR\Vc7\lib;$MVSDIR\Vc7\PlatformSDK\Lib"
</pre>

<p>For Mangel-Wurzel:</p>
<pre>
setenv PURIFY_DIR "C:\Program Files\Rational\PurifyPlus"
setenv MANGEL_DIR "C:\cygwin\home\sjl\mangel-wurzel"
</pre>
</li>
<li> You also need to set your path to include the bin directories for
Java, Visual C/C++, Purify, and Mangel-Wurzel, in addition to all the standard
places, something like this:
<pre>
setenv PATH .:/usr/local/bin:/usr/bin:/bin:/usr/X11R6/bin:/usr/lib/lapack:\
  /home/sjl/mangel-wurzel/bin:\
  /cygdrive/c/Program_Files/Java/jdk1.5.0_05/bin:\
  /cygdrive/c/WINDOWS/system32:/cygdrive/c/WINDOWS:\
  /cygdrive/c/WINDOWS/System32/Wbem:\
  /cygdrive/c/Program_Files/Microsoft_Visual_Studio/Vc7/bin:\
  /cygdrive/c/Program_Files/Microsoft_Visual_Studio/Common7/IDE:\
  /cygdrive/c/Program_Files/Rational/Common:\
  /cygdrive/c/Program_Files/Rational/PurifyPlus:\
  /cygdrive/c/Program_Files/Rational/PurifyPlus/cache
</pre>

Note that PATH uses Unix-like file syntax instead of Windows-like.
(You can use the cygpath utility to convert back and forth.)  Also, it's
useful to creat a shortcut named "Program_Files" to point to the "Program
Files" directory since it's a pain dealing with pathnames with spaces
in Cygwin.</li>

<li> Make sure you have your <a href="#purify-windows">Purify license</a> 
set up correctly.</li>

<li> You might want to do a sanity check on your configuration stuff by
compiling "hello, world" with the Visual C/C++ compiler and running
Purify on it.
<br />
Visual C/C++ compiler documentation is available
<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccore/html/_core_building_on_the_command_line.3a_.overview.asp">here</a>, while
Purify documentation is only available through its online "help" menu.</li>

</ol>


<hr />

<p><a href="../">Daikon invariant detector</a></p>

<address>
  <a href="http://pag.csail.mit.edu/~mernst/">Michael Ernst</a>
</address>

</body>
</html>

<!--  LocalWords:  TSE cshrc yourusername cvsrc LD csh setenv dfec jre cwd
 -->
<!--  LocalWords:  CLASSPATH Classpath RTJAR ARGV cvs gz mkdir cd chmod rx cp
 -->
<!--  LocalWords:  chgrp inv dotfiles filesystem autoload pcl Dired chsh javac
 -->
<!--  LocalWords:  Jikes jikes dtrace DTRACEFILE Baz html ps pdf
 -->
<!--  LocalWords:  daikongroupmember tarfile jdoc whiteboard texinfo pp fs sa
 -->
<!--  LocalWords:  pag admin rl co java kvasir ssh daikon diff IDE DIR Foo dist
 -->
<!--  LocalWords:  subsubsection daikonuser webserver
 -->
