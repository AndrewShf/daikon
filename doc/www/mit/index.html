<html>
<head>
<TITLE>Using Daikon at MIT LCS</TITLE>
<link rev="made" href="mailto:mernst@lcs.mit.edu">
</head>
<body>

<h1>Using Daikon at MIT LCS</h1>

This document tells you how to get started using Daikon on the PAG machines
(all named after root vegetables) at the MIT Lab for Computer Science.
These steps are primarily for students and other colleagues working with
Michael Ernst; if you do not need access to the central repository of code
and data, you can simply <a href="../download">download</a> the Daikon
distribution to your own computer.

<p>
The steps are simple, but there are many of them.  You
might wish to print this out (along with the <a
href="../download/doc/daikon.html">Daikon manual</a>) and check off items as
you ensure that they are correct.
<p>

You should already be familiar with <a href="../">the Daikon homepage</a>
and <a href="../download/">the Daikon distribution</a>.  See the <a
href="../download/doc/daikon.html">Daikon manual</a> for more details.
<p>

Contents: <!-- auto-generated by html-toc -->
    <ul>
      <li><a href="#getting-started">Getting started</a>
        <ul>
          <li><a href="#learning-about-daikon">Learning about Daikon</a>
          <li><a href="#getting-account">Getting a computer account</a>
          <li><a href="#getting-daikon">Getting your copy of Daikon</a>
            <ul>
              <li><a href="#local-cvs">Local CVS</a>
              <li><a href="#remote-cvs">Remote CVS</a>
              <li><a href="#using-cvs">Using CVS</a>
            </ul>
          <li><a href="#environment-2">Notes on your environment</a>
        </ul>
      <li><a href="#running-daikon">Running Daikon</a>
      <li><a href="#editing-daikon">Editing Daikon source code</a>
        <ul>
          <li><a href="#code-conventions">Coding conventions</a>
          <li><a href="#regression-tests">Testing Daikon</a>
          <li><a href="#editing-daikon.texinfo">Editing daikon.texinfo</a>
        </ul>
      <li><a href="#admin">Reporting on your research</a>
    </ul>
<p>

<h2><a name="getting-started"></a>Getting started</h2>

<h3><a name="learning-about-daikon"></a>Learning about Daikon</h3>

In order to become familiar with the theory of dynamic invariant detection
and some details of the Daikon implementation, see the following papers:
<ul>
  <li><a href="http://pag.lcs.mit.edu/~mernst/pubs/invariants-tse-abstract.html">Dynamically
      Discovering Likely Program Invariants to Support Program
      Evolution</a> (IEEE TSE, v27#2, Feb 2001, pp 1-25)<br>
      I call this "the invariants paper" as it was the first exposition of
      the idea of dynamic invariant detection.  The first four and last
      three sections are more important than the middle four; you might
      want to skim the latter if you are short on time.
  <li><a href="http://pag.lcs.mit.edu/~mernst/pubs/invariants-icse2000-abstract.html">Quickly Detecting Relevant Program Invariants</a> (ICSE 2000)<br>
      I call this "the relevance paper"; it discusses essential
      improvements to the basic technique.
  <li><a href="http://pag.lcs.mit.edu/~mernst/pubs/invariants-pointers-abstract.html">Dynamically
      Discovering Pointer-Based Program Invariants (Technical Report, 2000)</a><br>
      I call this "the pointers paper"; it shows how to deal with recursive
      data structures.  It isn't as fundamental as the previous two.
</ul>
<p>


<h3><a name="getting-account"></a>Getting a computer account</h3>

<!-- machines:
  beet
  cassava
  daikon
  manioc
  meoptiplex
  potato
  scallion
  shallot
  turnip
  yam
available:
  celeriac
  finnochio
  kumara
  rutabaga
already taken:
  carrot
  onion
  radish
taken, but possibly available ("ping" fails):
  garlic
-->

You should perform your work on one of these client machines:  
  beet,
  cassava,
  daikon,
  manioc,
  meoptiplex,
  potato,
  scallion,
  shallot,
  turnip,
  yam.
All of the client machines use the
geyer.lcs.mit.edu (also known as pag.lcs.mit.edu) filesystem, which has
plenty of disk space and direct access to the main CVS repository and
precompiled binaries.  (You should not work on geyer itself, which is a
file server, mail server, etc.  When possible, avoid running
extraordinarily intensive jobs on a machine that someone else is
currently using.)
You are also welcome to work from elsewhere if you
prefer.  Several of the client machines are in room 413, to which you
should obtain a key (get the required form from Neena Lyall in room 523);
or, you can use them remotely.
<p>

Do not use standard telnet or rlogin to log into the machines remotely;
always use ssh.  Similarly, for file transfer, use anonymous means or use
scp.  The ssh and scp programs protect your password from eavesdroppers; we
don't want our machines to get broken into due to negligence.  To change
your password, use the <tt>yppasswd</tt> command; do not use plain
<tt>passwd</tt>.
<p>

Ask <a href="mailto:mernst@lcs.mit.edu">Michael Ernst</a> or someone else
with sysadmin privileges to make you an account; be sure to specify the
username you prefer.  Only that person needs to know the <a
href="geyer-account.html">details of account creation</a>.
<p>

When you log in, you will encounter an error in your initial
<tt>.bashrc</tt> or <tt>.cshrc</tt> until you <a href="#local-cvs">check
out your copy of the CVS repository</a>.
<p>


<!-- All this is taken care of automatically; don't mention them here, in
order to avoid overloading readers.
-->

<!-- <h2><a name="environment-1"></a>Setting up your environment (part 1, before installing Daikon)</h2>


Mail to <em>yourusername</em>@pag.lcs.mit.edu will be forwarded according
to the contents of your <tt>.forward</tt> file, which you may change if you
like.<p>

It is important that you be a member of the "invariants" Unix group.  (Run
the command <tt>groups</tt> to see which ones you are in.)  If you are not
in these groups, you cannot access the CVS repository.<p>

To make CVS produce diffs in "unified format", and to make CVS create
directories that exist in the repository but are missing from the working
directory, create a file in your home directory named <tt>.cvsrc</tt>
containing the following contents:
<blockquote>
<pre>
diff -u
update -d -P
</pre>
</blockquote>
or just <a href=".cvsrc">download this one</a> to your home directory.
<p>

If you wish to run <tt>dfej</tt> on a PAG machine, then you will need to
adjust your LD_LIBRARY_PATH environment variable.  A reasonable setting
(csh syntax; this would go in your <tt>.cshrc</tt> file) is
<blockquote>
<pre>
setenv LD_LIBRARY_PATH   /usr/X11R6/lib:/usr/local/lib:/usr/lib:/lib
</pre>
</blockquote>
<p>

Stable versions of both <tt>dfej</tt> and <tt>dfec</tt> (the Daikon Front
End for Java) appear in 
<tt>~mernst/research/invariants/binaries</tt>.  You should put that
directory on your path or make links to those binaries from a directory on
your path.  (The development version of <tt>dfej</tt>, the Daikon Front End
for Java, is available via CVS, and one checked-out version appears in
<tt>~mernst/research/invariants/dfej/src/</tt>.)
<p>

I recommend that you use the latest possible version of the JDK (Java
Development Kit).  A link to this  can always be found at
<tt>/g2/jdk</tt>; you probably want to put the
<tt>bin</tt> subdirectory in your path and to add 
<tt>jre/lib/rt.jar</tt> and <tt>lib/tools.jar</tt> to the end of your
CLASSPATH:
<pre>
  set path = ( /g2/jdk/bin $path )
  setenv CLASSPATH ${CLASSPATH}:/g2/jdk/jre/lib/rt.jar:/g2/jdk/lib/tools.jar
</pre>
<p>

-->



<!-- <h4><a name="classpath"></a>Classpath</h4>

(by Jeremy Nimmer)
<p>

In case anyone is curious, this is how I set my CLASSPATH.  If you use this,
you should change $INV to where your CVS checkout of <tt>invariants</tt> is.
<p>

<pre>
setenv INV ${HOME}/research/invariants
setenv JAVA_HOME /g2/jdk
setenv RTJAR ${JAVA_HOME}/jre/lib/rt.jar
setenv DAIKON_LIBS `/usr/bin/perl -e 'print join(":", @ARGV);' ${INV}/java/lib/*.jar`
setenv CLASSPATH .:${INV}/java:${DAIKON_LIBS}:${RTJAR}
</pre>

This includes on your path:
<pre>
  .            - the cwd
  $INV/java    - your current checkout of daikon engine
  $DAIKON_LIBS - all of the .jar files in $INV/java/lib
  $RTJAR       - the JDK runtime (for jikes)
</pre>

-->

<h3><a name="getting-daikon"></a>Getting your copy of Daikon</h3>

For work on the PAG machines, you should check out a copy of the system
from the CVS repository.  Alternately, you can always download and install
Daikon from its .tar.gz distribution.
<!--  (A third option is to add <tt>~mernst/java</tt> or some other
installation to your Java classpath.  This is easy, but is deprecated,
because it does not permit you to modify the system and it does not
insulate you from incompatible changes or partial work of others.)
-->
<p>

Checking out Daikon from the CVS repository has several advantages:
<ul>
  <li>You will have access to a number of files intended for developer use
      which are not present in the distribution.
  <li>It is very easy to update to the latest version of the software,
      retaining any personal customizations you have made.
  <li>You can make changes and incorporate them in the master version of
      Daikon. 
</ul><p>

There are two modules (directories) available via anonymous CVS from
pag.lcs.mit.edu:  <tt>invariants</tt> (the bulk of the Daikon invariant
detection system, which is written in Java) and <tt>dfej</tt> (the Daikon
front end for Java, which is written in C++).  If you obtain Daikon from
the CVS repository, you will also need to obtain some <a
href="#packages-used-by-daikon">additional packages</a> which are used by
Daikon but do not appear in the repository.
<p>

You can learn how to use CVS from
<a href="http://www.cvshome.org/new_users.html">CVS for new
users</a>, or the <a href="http://www.gnu.org/manual/cvs-1.9/cvs.html">CVS
manual</a> (<a
href="http://www.cvshome.org/docs/manual/index.html">alternate site</a>).
<p>

<h4><a name="local-cvs"></a>Local CVS</h4>

The following commands create and populate the
<tt>~/research/invariants</tt> directory:
<pre>
    mkdir ~/research
    cd ~/research
    cvs -d /g4/projects/invariants/.CVS co invariants
    chgrp -R invariants invariants
    chmod -R g+r invariants
    chmod g+x `find invariants -type d -print`
    cd invariants/java/daikon
    cvs update -r ENGINE_V2_PATCHES
</pre>
(The last two lines make sure that you use Daikon version 2, rather than
the experimental version 3.)
<p>

Optionally, you may check out a copy of the <tt>dfej</tt> directory.
You should not need to do this, however; just use the executable in
<tt>/home/httpd/html/pag/daikon/download/binaries/mit</tt>, which should
already be on your path.  If you do check out the <tt>dfej</tt> directory,
use this command:
<pre>
    cd ~/research/invariants
    cvs -d /g4/projects/invariants/.CVS co dfej
</pre>
<p>


<h4><a name="remote-cvs"></a>Remote CVS</h4>

You can also create your copy of the repository on a remote machine (that
is, not pag or a taproot machine).  You can do so using anonymous CVS or
regular CVS.
<ul>
  <li><a href="../anoncvs.html">Anonymous CVS instructions</a>
  <li><a href="../remote-cvs.html">Regular remote CVS instructions</a>.
      Also, see a description of <a
      href="http://www.cag.lcs.mit.edu/~rugina/ssh-procedures/">using ssh
      without password queries</a>.
</ul>
<p>


<h4><a name="using-cvs"></a>Using CVS</h4>

CVS permits multiple people to simultaneously edit (their own copy of) a
set of files, then merge the changes.  See the CVS manual to learn more.
The key commands are:
<dl>
  <dt><tt>cvs update -d</tt>
  <dd>update your version of the files from the repository
  <dt><tt>cvs diff</tt>
  <dd>show difference between your version and the repository
  <dt><tt>cvs add <i>FILENAME ...</i></tt>
  <dd>add a file to the repository (must also commit it)
  <dt><tt>cvs commit <i>[FILENAME ...]</i></tt>
  <dd>put your version of the file in the repository; don't forget to
      include a descriptive message regarding what changed
</dl>
I find it much easier to perform CVS manipulations in Emacs.  First, put
<tt>(autoload 'cvs-update "pcl-cvs" nil t)</tt> in your <tt>.emacs</tt> file.
Then, you can do <tt>M-x cvs-update</tt> to get a Dired-like listing of
(changed) files in the directory.  As with any Emacs mode, do
<tt>C-h m</tt> (help on mode) for details about how to use CVS mode in
Emacs.<p>

You should do <tt>cvs update</tt> frequently, in order to avoid conflicts
(where someone else has changed something that you have also changed).
Please commit your changes fairly regularly, too, so that others can take
advantage of your changes.  But never commit changes without having tested
them first, and use a descriptive CVS comment when you commit.
<p>


<!-- <h4><a name="packages-used-by-daikon"></a>Packages used by Daikon</h4>

Daikon relies on several other packages that appear in the <tt>java/lib</tt>
directory.  You will need to add those <tt>.jar</tt> files to your
classpath; for instance,
<pre>
  setenv CLASSPATH $HOME/research/invariants/java:$HOME/research/invariants/java/lib/jakarta-oro.jar:$HOME/research/invariants/java/lib/java-getopt.jar:$HOME/research/invariants/java/lib/junit.jar:$CLASSPATH
</pre>

<p>(An easier way to have include these packages as part of your
CLASSPATH is given above in the <a href="#classpath">classpath</a>
section.  If you use that approach, you do not have to add the
packages by hand.)
-->

<h3><a name="environment-2"></a>Notes on your environment</h3>

By default, your account uses bash as its shell.  To use another shell, run
the <tt>chsh</tt> command (for instance, <tt>chsh -s /bin/tcsh</tt>), then log
out and log back in.
<p>

For compiling Java programs, you may wish to use <tt>jikes</tt> instead of
<tt>javac</tt>.  Jikes tends to be faster than javac.  If you have any
problems with it, you can always fall back to using javac.  To use jikes,
add the line
<pre>
    JAVAC ?= jikes -g +E +F
</pre>
to your <tt>$inv/java/Makefile.user</tt> file.
<p>

In order to permit other members of the Daikon project to read your files,
you should either make them world-readable, or place them in the
<tt>invariants</tt> group and make them group-readable.  You may or may not
need to re-run the following commands periodically to ensure that new files
are readable, depending on how your environment and editor are set up.
<blockquote>
<pre>
## <em>Do one of the following for each directory the group should be able to read</em>
# <em>To make a directory world-readable:</em>
chmod -R +r <em>DIR</em>
# <em>To make a directory group-readable, run two commands:</em>
chmod -R g+r <em>DIR</em>
chgrp -R invariants <em>DIR</em>
</pre>
</blockquote>
<p>

A few other environment details:
<ul>
  <li>Make sure that all the files in <tt>invariants/scripts</tt> are
      executable:
<pre>
	chmod a+x invariants/scripts/*
</pre>
      (They should be executable already when you check them out from the
      CVS repositor, so this step shouldn't be necessary.)
  <li>You can receive an email notification whenever files (in particular
      directories of your choosing) are checked in.  To receive such
      notifications, edit
      <tt>/g4/projects/invariants/.CVS/CVSROOT/loginfo</tt>.  This file is
      under RCS control; in Emacs, do <tt>C-x C-q</tt> before editing it
      and again after editing it.  Note that some of the lists of email
      addresses are space-separated and others are comma-separated.
<p>
</ul>
<p>

Michael Ernst's work related to invariant inference is in
<tt>~mernst/research/invariants/</tt>.  Many, but not all, of the files
under that directory are under CVS version control.  Feel free to look
around, and also see my dotfiles, such as <tt>~mernst/.cshrc</tt>, for
potential customizations (but don't go overboard by copying everything
there).<p>



<h2><a name="running-daikon"></a>Running Daikon</h2>

See the <a href="../download/doc/daikon.html">Daikon manual</a> for instructions.
<p>


<h2><a name="editing-daikon">Editing Daikon source code</a></h2>

<h3><a name="code-conventions">Coding conventions</a></h3>

Every code file that you write (Java classes, perl scripts, etc.) needs to
have a comment at the top explaining exactly what is does and (if
applicable) how to run it.  Otherwise it will be a mystery to others -- and
perhaps to you when you return to it.  In some cases one or two sentences
will do; in many other cases, the description needs to be more complete.
Every non-trivial procedure should also contain a brief comment saying what
it does.
<p>

All perl scripts should
<ol>
  <li>use <tt>#!/usr/bin/env perl</tt> as their first line, to permit
      independence from the specific location where perl is installed.
  <li>include the following code, which enables checking for common perl
      errors, near the top of the file (but usually after the brief
      description of the script's purpose and how to use it):
<pre>
  use English;
  use strict;
  $WARNING = 1;
</pre>
</ol>
<p>

When code has a consistent style, particularly within a single file but
also over an entire project, the code is much easier to read and
understand.  I don't wish to spend an excessive amount of time or energy
promulgating coding guidelines, but here are a few things to pay
attention to when you contribute to Daikon.
<p>

Every class should have a descriptive comment at the top -- perhaps just
one or two sentences, perhaps something more extensive.  This is very
important now that there are many people working on the project, as it will
help those people understand what a class is intended to do.  (It wasn't
always true for code written when there was only one person working on the
project; we will try to correct that code by stages.  If you have problem
with any code, definitely ask for help so the code and/or comments can be
improved.)
<p>

Use a consistent indentation style.  When editing an existing file, adopt
its indentation style rather than writing your additions in an incompatible
style.  In Emacs, you can use procedure `<tt>c-set-basic-offset</tt>',
defined in <tt>invariants/emacs/c-set-basic-offset.el</tt>, to set the
indentation amount to whatever an existing file already happens to use (for
C and Java code).
<p>

When a comment is a sentence, start it with a capital letter, end it with a
period, and use correct grammar.
Please keep comments to 80 characters and code to 80 characters whenever
possible.  This makes it possible to print the code in a readable fashion
and also to read the code in a standard-sized window.
<p>

Place whitespace around the outside of grouping punctuation.  For instance,
use "<tt>if (foo) bar;</tt>" rather than "<tt>if(foo)bar;</tt>" and use
"<tt>} else {</tt>" rather than "<tt>}else{</tt>".  Also place space after
<tt>//</tt> that starts a comment.  Jamming punctuation against other
entities in a program, makes the program very hard to read.
<p>

Do not comment out large blocks of code with <tt>/*</tt> ... <tt>*/</tt>;
instead, prefix each line by <tt>// </tt>.  Among other things, this does
not lose the indentation of the original code; without that indentation,
the commented-out code is much too hard to read and understand.  It also
makes it clear what is commented out and what is not, even when the code
is printed or is viewed without color highlighting.
<p>

Do not place files in the CVS repository with DOS-style line separators;
use Unix-style separators (at least when first adding a file).  The CVS
tools don't cope well with DOS line separators; for instance, they may
erroneously indicate that an entire file is modified, making merges and
updates very difficult.
<p>


<h3><a name="regression-tests">Testing Daikon</a></h3>

Daikon has two sets of tests:  regression tests and unit tests.
If there are any differences between the expected results and the ones you
get, don't check in your changes until you understand which is the desired
behavior and possibly update the goals.
<p>

The unit tests are found in <tt>invariants/java/daikon/test/</tt>; they use
the JUnit unit testing framework.  They are automatically run each time you
compile Daikon (by running <tt>make</tt> in a directory under
<tt>$inv/java</tt>).<p>

Always run the regression tests when checking in any non-trivial change to
the code.  The regression tests appear in the <tt>invariants/tests</tt>
directory.  Type <tt>make</tt> in that directory to see a list of options.
Generally you will want to run <tt>make diffs</tt> and ensure that the list
of diff files that is created all have zero size.  If any has a non-zero
size, then your edits have changed Daikon's output and you should not check
in without carefully determining that the changes are intentional and
desirable (and you should update the goal output files, so that the diffs
are again zero).
<p>

You can report bugs, examine reported bugs, and edit or remove existing bug
reports by running the <tt>daikon-bug</tt> program.  Run it without arguments
to see valid arguments.  The bugs themselves are stored in directory
<tt>$inv/bugs</tt>.
<p>


<h3><a name="editing-daikon.texinfo"></a>Editing daikon.texinfo</h3>

The Daikon manual appears in <tt>doc/daikon.texinfo</tt>.  The manual is
written using the Texinfo formatting system, which makes it easy to produce
HTML, info, or printed (PostScript and PDF) output.

<p>
You can edit the manual using an ordinary text editor.  You can either
mimic the formatting commands that already appear in the manual or read the
<a href="http://texinfo.org">Texinfo documentation</a>.

<p>
If you wish to create a new section of the manual, insert two lines like
the following:
<blockquote>
<pre>
@node    <em>Short title</em>, Foo, Bar, Baz
@<em>chapter</em> <em>Long title</em>
</pre>
</blockquote>
where you should insert "Foo, Bar, Baz" literally (they will be fixed up
for you automatically), you select the short and the long titles (which may
even be the same), and you may replace "@chapter" by "@section",
"@subsection", or "@subsubsection".

<p>
Once you have edited the manual, run <tt>make</tt> twice (yes, you must run
it twice) in order to generate formatted versions of the manual
(<tt>daikon.{html,info,ps,pdf}</tt>).
<p>


<h2><a name="admin">Reporting on your research</a></h2>

The outcome of research -- whether at the UROP, M.Eng., or Ph.D. level --
should be a paper describing what was learned and disseminating that
knowledge for the benefit of other researchers and practitioners.  For
instance, a summer's work might result in a conference or workshop paper.
Please keep in mind where your results might be published and whether what
you are doing contributes to the state of knowledge (either directly or
indirectly).
<p>

Each week, each group member prepares a written progress report as a short
email message.  It only needs to be a couple paragraphs or a page long and
will probably only take 15-30 minutes to compose, but it should explain
what you have accomplished, what you have learned, and what you plan to do
next.  This is very helpful both in permitting others to understand what
you have done, and also in focusing your attention on whether you have been
productive and keeping you on top of your progress.
<!-- <br>
As of summer 2001, the reports are written on Thursdays, and individual
meetings with Michael Ernst are on Fridays.
-->
<p>

Each week, the Daikon group meets to hear a more in-depth report on the
current state of one group member.  Each member presents during group
meeting every 2-3 months.  These presentations may be informal, but they
should be organized in a way that permits others to both understand and
critique the work.  The presentation may use handouts, overhead
transparencies, and/or a whiteboard.  Plan the presentation for 20-30
minutes; questions are likely to draw out the meeting to one hour, but we
will try to avoid meetings longer than that.
<p>


<hr>
<a href="../">Daikon invariant detector</a><p>

<address>
  <a href="http://pag.lcs.mit.edu/~mernst/">Michael Ernst</a>
</address>

</body>
</html>
